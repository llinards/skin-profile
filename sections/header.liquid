<header class="relative container mx-auto">
  <div class="flex justify-center absolute z-3 w-full" x-data="handleMobileMenu()" x-cloak>
    <nav class="mx-auto px-4 sm:px-6 w-full" role="navigation" aria-label="Main navigation">
      {% assign links = linklists['main-menu'].links %}

      <!-- Determine inversion classes based on block settings -->
      {% assign invert_links = false %}
      {% assign invert_logo = false %}
      {% assign invert_cart = false %}

      {% for block in section.blocks %}
        {% if block.type == 'color_inversion' %}
          {% assign invert_links = block.settings.invert_links %}
          {% assign invert_logo = block.settings.invert_logo %}
          {% assign invert_cart = block.settings.invert_cart %}
        {% endif %}
      {% endfor %}

      {% assign link_class = '' %}
      {% assign logo_class = '' %}
      {% assign cart_class = '' %}

      {% if invert_links %}
        {% assign link_class = 'invert' %}
      {% endif %}

      {% if invert_logo %}
        {% assign logo_class = 'invert' %}
      {% endif %}

      {% if invert_cart %}
        {% assign cart_class = 'invert' %}
      {% endif %}

      <!-- DESKTOP MENU -->
      <div class="hidden lg:flex items-center justify-between space-x-10 py-4">
        <div class="flex flex-row space-x-8 {{ link_class }}">
          {% for link in links %}
            {% if forloop.index <= 3 %}
              {% if link.links != blank %}
                {% render 'dropdown-menu-link', link: link %}
              {% else %}
                {% render 'menu-link', link: link %}
              {% endif %}
            {% endif %}
          {% endfor %}
        </div>

        <!-- LOGO -->
        <div class="{{ logo_class }}">
          <img
            src="{{ 'skin-profile-logo-white.svg' | asset_url }}"
            alt="{{ shop.name }} logo"
            height="1024"
            width="1024"
            class="w-58 h-18"
          >
        </div>

        <div class="flex space-x-8">
          <div class="{{ link_class }}">
            {% for link in links %}
              {% if forloop.index > 3 %}
                {% if link.links != blank %}
                  {% render 'dropdown-menu-link', link: link %}
                {% else %}
                  {% render 'menu-link', link: link %}
                {% endif %}
              {% endif %}
            {% endfor %}
          </div>
          <div class="{{ cart_class }}">
            {% render 'cart-counter' %}
          </div>
        </div>
      </div>

      <!-- MOBILE MENU -->
      <div>
        <div class="lg:hidden flex items-center justify-between py-4 w-full">
          <button
            x-on:click="open = !open"
            type="button"
            aria-label="Toggle mobile menu"
            aria-controls="mobile-menu"
            :aria-expanded="open.toString()"
            class="flex items-center justify-left cursor-pointer z-2 w-1/7 {{ link_class }}"
          >
            <span x-show="!open">{% render 'icon-mobile-menu' %}</span>
            <span x-show="open">{% render 'icon-mobile-menu-close' %}</span>
          </button>

          <div class="flex items-center justify-center z-2 w-5/7">
            <img
              src="{{ 'skin-profile-logo-white.svg' | asset_url }}"
              alt="{{ shop.name }} logo"
              height="1024"
              width="1024"
              class="w-48 {{ logo_class }}"
              :class="open ? 'invert' : ''"
            >
          </div>

          <div class="{{ cart_class }}">
            {% render 'cart-counter' %}
          </div>
        </div>

        <div
          id="mobile-menu"
          x-show="open"
          x-transition:enter="transition-all duration-300 ease-out"
          x-transition:enter-start="-translate-x-full opacity-0"
          x-transition:enter-end="translate-x-0 opacity-100"
          x-transition:leave="transition-all duration-300 ease-in"
          x-transition:leave-start="translate-x-0 opacity-100"
          x-transition:leave-end="-translate-x-full opacity-0"
          class="bg-white text-black h-screen fixed inset-0 z-0 flex flex-col items-center justify-center space-y-6 lg:hidden"
        >
          <div class="flex flex-col space-y-4">
            {% for link in links %}
              {% if link.links != blank %}
                {% render 'dropdown-menu-link', link: link %}
              {% else %}
                {% render 'menu-link', link: link %}
              {% endif %}
            {% endfor %}
          </div>
        </div>
      </div>
    </nav>
  </div>
</header>

{% schema %}
{
  "name": "t:general.header",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "t:labels.menu"
    }
  ],
  "blocks": [
    {
      "type": "color_inversion",
      "name": "Color Inversion",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "invert_links",
          "label": "Invert link colors",
          "default": false,
          "info": "Inverts the color of navigation links"
        },
        {
          "type": "checkbox",
          "id": "invert_logo",
          "label": "Invert logo colors",
          "default": false,
          "info": "Inverts the color of the logo"
        },
        {
          "type": "checkbox",
          "id": "invert_cart",
          "label": "Invert cart icon colors",
          "default": false,
          "info": "Inverts the color of the cart counter"
        }
      ]
    }
  ]
}
{% endschema %}
