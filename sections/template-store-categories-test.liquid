{% comment %}
  This section renders a carousel of clickable category cards.
  Each card links to the main collection page with a specific filter applied.
{% endcomment %}

{%- if section.blocks.size > 0 -%}
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const carousel = Carousel(document.getElementById('categoryCarousel-{{ section.id }}'), {
        fill: true,
        infinite: false,
        plugins: [window.Dots],
      }).init();
    });
  </script>

  <div class="container mx-auto px-4 pb-12 transition-hide text-center md:text-left">
    {%- if section.settings.heading != blank -%}
      <h2 class="pb-6 md:pb-12">{{ section.settings.heading }}</h2>
    {%- endif -%}
    <div>
      <div class="f-carousel pb-6 md:pb-12" id="categoryCarousel-{{ section.id }}">
        {%- for block in section.blocks -%}
          <div class="f-carousel__slide h-full rounded-4xl">
            {%- comment -%}
              Construct the URL:
              1. Use the correct shorthand 'm' for metafield.
              2. The value from the block settings MUST be case-sensitive.
            {%- endcomment -%}
            {%- assign filter_param = 'filter.p.m.custom.produkta_kategorija' -%}
            {%- assign filter_value = block.settings.category_name_for_filter | url_encode -%}
            {%- assign category_url = routes.all_products_collection_url
              | append: '?'
              | append: filter_param
              | append: '='
              | append: filter_value
            -%}

            <a href="{{ category_url }}" aria-label="{{ block.settings.name | escape }}">
              {%- if block.settings.photo -%}
                <div class="relative overflow-hidden h-108 rounded-3xl cursor-pointer flex items-center justify-center group">
                  <img
                    src="{{ block.settings.photo | image_url }}"
                    alt="{{ block.settings.name | escape }}"
                    width="1080"
                    height="1920"
                    loading="lazy"
                    class="h-108 w-full object-cover transition-transform duration-300 ease-in-out group-hover:scale-105"
                  >
                  <div class="absolute inset-0 bg-black/30 w-full flex items-center justify-center px-4">
                    <h3 class="text-white text-xl body-font md:text-2xl 2xl:text-3xl px-6 leading-tight text-center w-full break-words line-clamp-2">
                      {{ block.settings.name }}
                    </h3>
                  </div>
                </div>
              {%- endif -%}
            </a>
          </div>
        {%- endfor -%}
      </div>
    </div>
  </div>
{%- endif -%}

{% schema %}
{
  "name": "Category Carousel",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Section Heading",
      "default": "Shop by Category"
    }
  ],
  "blocks": [
    {
      "type": "category_slide",
      "name": "Category Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "photo",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "name",
          "label": "Display Name",
          "info": "The text that appears on the card."
        },
        {
          "type": "text",
          "id": "category_name_for_filter",
          "label": "Category Name for Filter",
          "info": "IMPORTANT: Must exactly match the 'produkta_kategorija' metafield value (case-sensitive)."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Category Carousel"
    }
  ]
}
{% endschema %}
