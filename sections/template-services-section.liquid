<div class="container mx-auto px-4 transition-hide max-w-7xl">
  <div class="space-y-0">
    {% for block in section.blocks %}
      {% if block.type == 'accordion' %}
        <div
          x-data="{ open: {{ block.settings.open_by_default | json }} }"
          class="overflow-hidden border-t-2"
          {{ block.shopify_attributes }}
        >
          <!-- Header -->
          <button
            type="button"
            @click="open = !open"
            class="w-full flex items-center justify-between px-2 py-4 text-left hover:bg-sp-light-brown transition-colors"
            :aria-expanded="open.toString()"
          >
            <h3 class="text-2xl md:text-4xl">
              {{ block.settings.title }}
            </h3>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
              class="w-6 h-6 text-sp-brown transition-transform"
              :class="{ 'rotate-180': open }"
            >
              <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5"/>
            </svg>
          </button>

          <!-- Body -->
          <div
            x-cloak
            x-show="open"
            x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0 -translate-y-2"
            x-transition:enter-end="opacity-100 translate-y-0"
            x-transition:leave="transition ease-in duration-150"
            x-transition:leave-start="opacity-100 translate-y-0"
            x-transition:leave-end="opacity-0 -translate-y-2"
            class="px-2 my-4 space-y-4"
          >
            {% if block.settings.content != blank %}
              <div class="prose max-w-none">
                {{ block.settings.content }}
              </div>
            {% endif %}

            {%- comment -%}
              Collect subsequent Service blocks until the next Accordion block.
              This avoids needing manual parent IDs and keeps UX simple.
            {%- endcomment -%}
            {%- assign start_index = forloop.index0 | plus: 1 -%}
            {%- assign printed_header = false -%}

            {% for sub in section.blocks offset: start_index %}
              {% if sub.type == 'accordion' %}
                {% break %}
              {% endif %}

              {% if sub.type == 'service' %}
                {% unless printed_header %}
                  {%- assign printed_header = true -%}
                  <div class="space-y-2 my-6 md:my-12">
                    {% if block.settings.show_headers %}
                      <div class="grid grid-cols-5 items-center py-2 border-b-1 border-sp-light-brown border-dotted font-bold">
                        <div class="col-span-3 text-left">{{ block.settings.left_label | default: 'Pakalpojums' }}</div>
                        <div class="col-span-2 text-right">
                          {{ block.settings.right_label | default: 'Pakalpojuma cena' }}
                        </div>
                      </div>
                    {% endif %}
                {% endunless %}

                <div
                  class="grid grid-cols-5 items-center py-2 border-b-1 border-sp-light-brown border-dotted"
                  {{ sub.shopify_attributes }}
                >
                  <div class="col-span-3 text-left">{{ sub.settings.service_name }}</div>
                  <div class="col-span-2 text-right font-semibold">{{ sub.settings.service_price }}</div>
                </div>
              {% endif %}
            {% endfor %}

            {% if printed_header %}
              </div>
            {% endif %}
          </div>
        </div>
      {% endif %}
    {% endfor %}
  </div>
</div>

{% schema %}
{
  "name": "Pakalpojumu akordeoni",
  "settings": [],
  "blocks": [
    {
      "type": "accordion",
      "name": "Akordeons",
      "settings": [
        { "type": "text", "id": "title", "label": "Virsraksts", "default": "Noklikšķiniet, lai atvērtu" },
        { "type": "richtext", "id": "content", "label": "Saturs", "default": "<p>Jūsu teksts šeit.</p>" },
        { "type": "checkbox", "id": "open_by_default", "label": "Atvērt pēc noklusējuma", "default": false },
        { "type": "checkbox", "id": "show_headers", "label": "Rādīt tabulas virsrakstus", "default": true },
        { "type": "text", "id": "left_label", "label": "Kreisā kolonna (virsraksts)", "default": "Pakalpojums" },
        { "type": "text", "id": "right_label", "label": "Labā kolonna (virsraksts)", "default": "Pakalpojuma cena" }
      ]
    },
    {
      "type": "service",
      "name": "Pakalpojums (rinda)",
      "settings": [
        { "type": "text", "id": "service_name", "label": "Nosaukums", "default": "Sejas tīrīšana" },
        { "type": "text", "id": "service_price", "label": "Cena", "default": "€45" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Pakalpojumu akordeoni",
      "blocks": [
        { "type": "accordion", "settings": { "title": "Sejas procedūras" } },
        { "type": "service", "settings": { "service_name": "Dziļa tīrīšana", "service_price": "€45" } },
        { "type": "service", "settings": { "service_name": "Hidratācija", "service_price": "€55" } },
        { "type": "accordion", "settings": { "title": "Ķermeņa procedūras" } },
        { "type": "service", "settings": { "service_name": "Iesaiņošana", "service_price": "€55" } }
      ]
    }
  ]
}
{% endschema %}
