{% comment %}
  This section renders a carousel of clickable category cards.
  Each card links to the main collection page with a specific filter applied.
{% endcomment %}

{%- if section.blocks.size > 0 -%}
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const carousel = Carousel(document.getElementById('category-carousel'), {
        fill: true,
        infinite: false,
        plugins: [window.Dots],
      }).init();
    });
  </script>
  <div id="product-categories">
    <div class="container mx-auto px-4 pb-12 transition-hide text-center md:text-left">
      {%- if section.settings.heading != blank -%}
        <h2 class="pb-6 md:pb-12">{{ section.settings.heading }}</h2>
      {%- endif -%}
      <div>
        <div class="f-carousel pb-6 md:pb-12" id="category-carousel">
          {%- for block in section.blocks -%}
            <div class="f-carousel__slide h-full rounded-4xl">
              {%- comment -%}
                Construct the URL:
                1. Use the correct shorthand 'm' for metafield.
                2. The value from the block settings MUST be case-sensitive.
              {%- endcomment -%}
              {%- assign filter_param = 'filter.p.m.custom.product_category' -%}
              {%- assign filter_value = block.settings.category_name_for_filter | url_encode -%}
              {%- assign category_url = routes.all_products_collection_url
                | append: '?'
                | append: filter_param
                | append: '='
                | append: filter_value
              -%}

              <a
                href="{{ category_url }}"
                aria-label="{{ block.settings.name | escape }}"
                class="category-card"
              >
                {%- if block.settings.photo -%}
                  <div class="relative overflow-hidden h-108 rounded-3xl cursor-pointer flex items-center justify-center group">
                    <img
                      src="{{ block.settings.photo | image_url }}"
                      alt="{{ block.settings.name | escape }}"
                      width="1080"
                      height="1920"
                      loading="lazy"
                      class="h-108 w-full object-cover transition-transform duration-300 ease-in-out group-hover:scale-105"
                    >
                    <div class="absolute inset-0 bg-black/30 w-full flex items-center justify-center px-4">
                      <h3 class="text-white body-font text-2xl lg:text-3xl leading-tight text-center w-full wrap-break-words line-clamp-2">
                        {{ block.settings.name }}
                      </h3>
                    </div>
                  </div>
                {%- endif -%}
              </a>
            </div>
          {%- endfor -%}
        </div>
      </div>
    </div>
  </div>
{%- endif -%}

{% schema %}
{
  "name": "Kategoriju Karuselis",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Sadaļas nosaukums",
      "default": "Kategorijas"
    }
  ],
  "blocks": [
    {
      "type": "category_slide",
      "name": "Category Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "photo",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "name",
          "label": "Kartes teksts",
          "info": "Teksts parādās uz kartes"
        },
        {
          "type": "text",
          "id": "category_name_for_filter",
          "label": "Produkta kategorija",
          "info": "Ievadi kategorijas nosaukumu (jābūt identiskam ar metafield vērtību)",
          "placeholder": "Sejas Kopšana"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Kategoriju Karuselis"
    }
  ]
}
{% endschema %}
