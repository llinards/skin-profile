{% comment %}
  This section is used in the product template to render product page with
  media, content, and add-to-cart form.
{% endcomment %}

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const minusBtn = document.getElementById('minus-btn');
    const quantity = document.getElementById('quantity');
    const plusBtn = document.getElementById('plus-btn');

    minusBtn.addEventListener('click', (e) => {
      e.preventDefault();
      const currentValue = parseInt(quantity.value);
      if (currentValue > 1) {
        quantity.value = currentValue - 1;
      }
    });

    plusBtn.addEventListener('click', (e) => {
      e.preventDefault();
      const currentValue = parseInt(quantity.value);
      quantity.value = currentValue + 1;
    });
  });
</script>

<div class="container mx-auto px-4 pt-24 pb-12 md:flex">
  <div class="hidden md:flex md:w-1/2">
    {% for image in product.images %}
      {% render 'image', class: 'product-image', image: image %}
    {% endfor %}
  </div>

  <div class="md:w-1/2">
    <div class="mb-6">
      <h1 class="text-4xl lg:text-5xl mb-4 md:pt-12">{{ product.title }}</h1>
      <span class="text-3xl md:text-4xl header-font block mb-4">{{ product.price | money }}</span>
      <div class="md:hidden">
        {% for image in product.images %}
          {% render 'image', class: 'product-image', image: image %}
        {% endfor %}
      </div>
      <div class="md:hidden">
        {% render 'dropdown-description',
          description_title: 'Apraksts',
          description_content: product.description,
          class: 'max-w-96'
        %}
      </div>
      <div class="hidden md:block space-y-4">{{ product.description }}</div>
    </div>
    <div class="product-form">
      {% form 'product', product %}
        <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">

        <div class="mb-6 flex flex-row justify-center sm:justify-start items-center gap-4 md:gap-6">
          <label for="quantity" class="uppercase font-bold text-sm tracking-widest">Daudzums</label>
          <div class="inline-flex items-center border rounded-2xl overflow-hidden w-fit">
            <button
              type="button"
              id="minus-btn"
              class="px-2.5 py-1.5 hover:bg-sp-light-brown transition-colors cursor-pointer"
            >
              <span class="text-sm leading-none font-bold">−</span>
            </button>

            <input
              id="quantity"
              type="number"
              name="quantity"
              min="1"
              value="1"
              class="w-8 text-center py-1.5 font-bold focus:outline-none text-sm"
              readonly
            >

            <button
              type="button"
              id="plus-btn"
              class="px-2.5 py-1.5 hover:bg-sp-light-brown transition-colors cursor-pointer"
            >
              <span class="text-sm leading-none font-bold">+</span>
            </button>
          </div>
          {%- assign stock_quantity = product.selected_or_first_available_variant.inventory_quantity -%}

          {% if product.metafields.custom.produkta_kategorija == 'Dāvanu kartes' %}
          {% else %}
            <p class="inline-flex border rounded-2xl px-4 py-1.5 font-bold text-sm tracking-widest uppercase">
              Pieejami: {{ stock_quantity }}
            </p>
          {% endif %}
        </div>

        {% if product.available %}
          {% render 'btn-add-to-cart', class: 'w-full text-base md:max-w-96 tracking-widest' %}
        {% else %}
          {% render 'btn-out-of-stock', class: 'w-full text-base md:max-w-96 tracking-widest' %}
        {% endif %}
      {% endform %}
    </div>

    {%- comment -%} Dynamic dropdown descriptions from blocks {%- endcomment -%}
    {%- if section.blocks.size > 0 -%}
      <div class="mt-6">
        {%- for block in section.blocks -%}
          {%- case block.type -%}
            {%- when 'dropdown_description' -%}
              {% render 'dropdown-description',
                description_title: block.settings.title,
                description_content: block.settings.content,
                class: 'max-w-96'
              %}
          {%- endcase -%}
        {%- endfor -%}
      </div>
    {%- endif -%}
  </div>
</div>

{% schema %}
{
  "name": "t:general.product",
  "settings": [],
  "blocks": [
    {
      "type": "dropdown_description",
      "name": "Dropdown Description",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Description Title"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content",
          "default": "<p>Add your description content here.</p>"
        }
      ]
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  }
}
{% endschema %}

{% stylesheet %}
  /* Hide number input spinners */
  input[type='number']::-webkit-outer-spin-button,
  input[type='number']::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  input[type='number'] {
    -moz-appearance: textfield;
  }
{% endstylesheet %}
