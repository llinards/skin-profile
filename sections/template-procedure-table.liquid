<div class="container mx-auto px-4 transition-hide max-w-8xl {% if section.settings.space_bottom %}mb-12{% endif %}">
  {%- if section.settings.enable_dropdown -%}
    <div
      x-data="{ open: {{ section.settings.open_by_default | json }} }"
      class="overflow-hidden border-t-2"
    >
      <!-- Dropdown Header -->
      <button
        type="button"
        @click="open = !open"
        class="
          group relative w-full flex items-start gap-3 px-2 md:px-0 md:pr-2 py-4 text-left hover:bg-sp-light-brown active:bg-sp-light-brown transition-colors cursor-pointer
          focus-visible:ring-1 focus-visible:ring-inset
        "
        :aria-expanded="open.toString()"
        :aria-label="open ? '{{ 'general.accordion.close_section' | t }}' : '{{ 'general.accordion.open_section' | t }}'"
      >
        <h3 class="flex-1 min-w-0 text-xl md:text-4xl leading-tight wrap-break-words">
          {{ section.settings.title }}
        </h3>

        <!-- Icon wrapper -->
        <span
          class="
            flex-none shrink-0 ml-2 inline-flex h-9 w-9 aspect-square items-center justify-center rounded-full border border-sp-light-brown transition-colors select-none
            group-hover:bg-sp-brown group-hover:text-white
          "
          :class="open ? 'bg-sp-brown text-white' : 'bg-sp-light-brown text-sp-brown'"
        >
          <!-- Plus -->
          <svg
            x-cloak
            x-show="!open"
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.8"
            aria-hidden="true"
          >
            <path stroke-linecap="round" d="M12 5v14M5 12h14" />
          </svg>
          <!-- Minus -->
          <svg
            x-cloak
            x-show="open"
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5 pointer-events-none"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.8"
            aria-hidden="true"
          >
            <path stroke-linecap="round" d="M5 12h14" />
          </svg>
        </span>
      </button>

      <!-- Dropdown Body -->
      <div
        x-cloak
        x-show="open"
        x-transition:enter="transition ease-out duration-200"
        x-transition:enter-start="opacity-0 -translate-y-2"
        x-transition:enter-end="opacity-100 translate-y-0"
        x-transition:leave="transition ease-in duration-150"
        x-transition:leave-start="opacity-100 translate-y-0"
        x-transition:leave-end="opacity-0 -translate-y-2"
        class="px-2 my-4 space-y-2"
      >
        {%- if section.settings.content != blank -%}
          <div class="rte mb-6">{{ section.settings.content }}</div>
        {%- endif -%}

        {%- assign apply_url_fallback = section.settings.apply_url | default: '#' -%}

        {% render 'procedure-table',
          services: section.blocks,
          disclaimer: section.settings.disclaimer,
          apply_url_default: apply_url_fallback,
          apply_cta: section.settings.apply_cta
        %}
      </div>
    </div>
  {%- else -%}
    {%- if section.settings.title != blank -%}
      <h2 class="text-xl md:text-4xl leading-tight wrap-break-words mb-6">{{ section.settings.title }}</h2>
    {%- endif -%}

    {%- if section.settings.content != blank -%}
      <div class="rte mb-6">{{ section.settings.content }}</div>
    {%- endif -%}

    {%- assign apply_url_fallback = section.settings.apply_url | default: '#' -%}

    {% render 'procedure-table',
      services: section.blocks,
      disclaimer: section.settings.disclaimer,
      apply_url_default: apply_url_fallback,
      apply_cta: section.settings.apply_cta
    %}
  {%- endif -%}
</div>

{% schema %}
{
  "name": "Procedūru tabula",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Virsraksts",
      "default": "Procedūras"
    },
    {
      "type": "richtext",
      "id": "content",
      "label": "Apraksts",
      "default": "<p>Jūsu teksts šeit.</p>"
    },
    {
      "type": "text",
      "id": "disclaimer",
      "label": "Atruna zem tabulas",
      "info": "Parādās zem procedūru tabulas."
    },
    {
      "type": "url",
      "id": "apply_url",
      "label": "Noklusējuma pieteikšanās saite",
      "info": "Izmanto, ja konkrētai procedūrai nav norādīta saite."
    },
    {
      "type": "text",
      "id": "apply_cta",
      "label": "Pieteikt poga teksts",
      "default": "Pieteikt"
    },
    {
      "type": "checkbox",
      "id": "enable_dropdown",
      "label": "Iespējot dropdown",
      "info": "Padarīt sadaļu salocāmu ar +/- pogu.",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "open_by_default",
      "label": "Atvērt pēc noklusējuma",
      "info": "Dropdown būs atvērts sākumā (ja dropdown ir iespējots).",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "space_bottom",
      "label": "Atstarpe",
      "info": "Pievienot apakšējo atstarpi (mb-12) šai sadaļai.",
      "default": false
    }
  ],
  "blocks": [
    {
      "type": "procedure",
      "name": "Procedūra",
      "settings": [
        {
          "type": "text",
          "id": "procedure_name",
          "label": "Procedūras nosaukums",
          "default": "Sejas tīrīšana"
        },
        {
          "type": "textarea",
          "id": "procedure_description",
          "label": "Īss apraksts",
          "default": "Dziļa ādas tīrīšana ar tonizēšanu",
          "info": "Ieteicams līdz 7 vārdiem"
        },
        {
          "type": "text",
          "id": "procedure_price",
          "label": "Cena",
          "default": "€45"
        },
        {
          "type": "text",
          "id": "procedure_duration",
          "label": "Ilgums (min)",
          "default": "60"
        },
        {
          "type": "richtext",
          "id": "contraindications_text",
          "label": "Kontraindikācijas teksts",
          "info": "Teksts, kas parādīsies modalā",
          "default": "<p>Kontraindikācijas informācija šeit.</p>"
        },
        {
          "type": "url",
          "id": "apply_url",
          "label": "Individuāla pieteikšanās saite",
          "info": "Ja tukšs, izmanto sadaļas noklusējuma saiti"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Procedūru tabula"
    }
  ]
}
{% endschema %}
