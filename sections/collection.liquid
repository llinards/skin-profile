<script src="{{ 'collection-pagination.js' | asset_url }}" defer></script>

<div
  class="container mx-auto px-4 pb-12 relative transition-hide"
  x-data="collectionFilters()"
  x-init="init()"
  id="products"
>
  <h2 id="products" class="pb-12">{{ collection.title | default: 'Produkti' }}</h2>

  <!-- Filters as Dropdowns on Desktop -->
  <div class="hidden filters-container sm:flex flex-col sm:flex-row sm:flex-wrap gap-4 mb-12" x-ref="filtersDesktop">
    {% render 'filter-regular' %}
    {% render 'filter-sort-by' %}
    {% render 'btn-clear-filter' %}
  </div>

  <!-- Mobile filters wrapped in a single dropdown -->
  {% render 'mobile-filter-wrapper' %}

  {% paginate collection.products by 12 %}
    <!-- Product Grid Wrapper -->
    <div class="relative z-1">
      {% render 'loading-screen' %}

      <div
        class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 md:gap-12 transition-opacity duration-300 h-full"
        x-ref="productGrid"
        :class="{ 'opacity-30': loading }"
      >
        {% for product in collection.products %}
          <div class="flex flex-col justify-between space-y-3">
            {% render 'product-card', product: product %}
          </div>
        {% else %}
          <div class="col-span-full text-center py-12">
            <p class="text-gray-600">Nav atrasti produkti ar Å¡iem filtriem.</p>
          </div>
        {% endfor %}
      </div>

      <!-- Pagination -->
      {% render 'paginate', paginate: paginate %}
    </div>
  {% endpaginate %}
</div>

{% stylesheet %}
  .loading-spinner {
    width: 40px;
    height: 40px;
    border: 4px solid #f3f3f3;
    border-top: 4px solid #885642;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "All Products",
  "settings": [
    {
      "type": "range",
      "id": "products_per_page",
      "label": "Products per page",
      "min": 8,
      "max": 24,
      "step": 4,
      "default": 12
    }
  ]
}
{% endschema %}
