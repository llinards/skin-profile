<div
  class="container mx-auto px-4 pb-12 "
  data-collection-root
>
  {%- if section.blocks.size > 0 -%}
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const carousel = Carousel(document.getElementById('category-carousel'), {
          fill: true,
          infinite: false,
          plugins: [window.Dots],
        }).init();
      });
    </script>
    <div id="product-categories">
      <div class="container mx-auto px-4 pb-12 transition-hide text-center md:text-left">
        {%- if section.settings.heading != blank -%}
          <h2 class="pb-6 md:pb-12">{{ section.settings.heading }}</h2>
        {%- endif -%}
        <div>
          <div class="f-carousel pb-6 md:pb-12" id="category-carousel">
            {%- for block in section.blocks -%}
              <div class="f-carousel__slide h-full rounded-4xl">
                {%- comment -%}
                  Construct the URL:
                  1. Use the correct shorthand 'm' for metafield.
                  2. The value from the block settings MUST be case-sensitive.
                {%- endcomment -%}
                {%- assign filter_param = 'filter.p.m.custom.product_category' -%}
                {%- assign filter_value = block.settings.category_name_for_filter | url_encode -%}
                {%- assign category_url = routes.all_products_collection_url
                  | append: '?'
                  | append: filter_param
                  | append: '='
                  | append: filter_value
                -%}

                <a
                  href="{{ category_url }}"
                  aria-label="{{ block.settings.name | escape }}"
                  class="category-card"
                  data-filter-param="filter.p.m.custom.product_category"
                  data-filter-value="{{ block.settings.category_name_for_filter | escape }}"
                >
                  {%- if block.settings.photo -%}
                    <div class="relative overflow-hidden h-108 rounded-3xl cursor-pointer flex items-center justify-center group">
                      <img
                        src="{{ block.settings.photo | image_url }}"
                        alt="{{ block.settings.name | escape }}"
                        width="1080"
                        height="1920"
                        loading="lazy"
                        class="h-108 w-full object-cover transition-transform duration-300 ease-in-out group-hover:scale-105"
                      >
                      <div class="absolute inset-0 bg-black/30 w-full flex items-center justify-center px-4">
                        <h3 class="text-white body-font text-2xl lg:text-3xl leading-tight text-center w-full wrap-break-words line-clamp-2">
                          {{ block.settings.name }}
                        </h3>
                      </div>
                    </div>
                  {%- endif -%}
                </a>
              </div>
            {%- endfor -%}
          </div>
        </div>
      </div>
    </div>
  {%- endif -%}

  <div class="relative transition-hide">
    <h2 class="pb-12">{{ collection.title | default: 'Produkti' }}</h2>

    <!-- Filters as Dropdowns on Desktop -->
    <div class="hidden filters-container sm:flex flex-col sm:flex-row sm:flex-wrap gap-4 mb-12" x-ref="filtersDesktop">
      {% render 'filter-regular' %}
      {% render 'filter-sort-by' %}
      {% render 'btn-clear-filter' %}
    </div>

    <!-- Mobile filters wrapped in a single dropdown -->
    <div x-ref="mobileFilterWrapper">
      {% render 'mobile-filter-wrapper' %}
    </div>

    {% paginate collection.products by 12 %}
      <div class="relative z-1">
        {% render 'loading-screen' %}

        <div
          class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 md:gap-12 transition-opacity duration-300 h-full"
          x-ref="productGrid"
          :class="{ 'opacity-30': loading }"
        >
          {% for product in collection.products %}
            <div class="flex flex-col justify-between space-y-3">
              {% render 'product-card', product: product %}
            </div>
          {% else %}
            <div class="col-span-full text-center py-12">
              <p class="text-gray-600">Nav atrasti produkti ar šiem filtriem.</p>
            </div>
          {% endfor %}
        </div>

        <!-- Pagination -->
        <div x-ref="pagination">
          {% render 'paginate', paginate: paginate %}
        </div>
      </div>
    {% endpaginate %}
  </div>
</div>
<script src="{{ 'collection-pagination.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "All Products",
  "settings": [
    {
      "type": "range",
      "id": "products_per_page",
      "label": "Products per page",
      "min": 8,
      "max": 24,
      "step": 4,
      "default": 12
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Kategoriju sadaļas nosaukums",
      "default": "Kategorijas"
    }
  ],
  "blocks": [
    {
      "type": "category_slide",
      "name": "Category Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "photo",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "name",
          "label": "Kartes teksts",
          "info": "Teksts parādās uz kartes"
        },
        {
          "type": "text",
          "id": "category_name_for_filter",
          "label": "Produkta kategorija",
          "info": "Ievadi kategorijas nosaukumu (jābūt identiskam ar metafield vērtību)",
          "placeholder": "Sejas Kopšana"
        }
      ]
    }
  ]
}
{% endschema %}
