{% comment %}
  This section is used in the collection template to render collection page
  listing all products within a collection.
  https://shopify.dev/docs/storefronts/themes/architecture/templates/collection
{% endcomment %}
<div
  class="container mx-auto px-4 pb-12"
  x-data="collectionPagination()"
  x-init="init()"
>
  <h2 class="pb-12">{{ collection.title | default: 'Produkti' }}</h2>

  {% paginate collections.all.products by 4 %}
    <div
      class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4"
      x-ref="productGrid"
    >
      {% for product in collections.all.products %}
        <div class="flex flex-col">
          {% if product.featured_image %}
            {% render 'image', image: product.featured_image, url: product.url, width: 400, height: 400, class: '' %}
          {% endif %}
          <div class="flex flex-col space-y-3 items-center justify-center">
            <h3 class="body-font text-center">{{ product.title | escape | link_to: product.url }}</h3>
            <p>{{ product.price | money }}</p>

            <form action="{{ routes.cart_add_url }}" method="post" enctype="multipart/form-data">
              <input type="hidden" name="id" value="{{ product.first_available_variant.id }}">
              {% if product.available %}
                <button type="submit" class="btn-add-to-cart">
                  {{ 'products.add_to_cart' | t | default: 'Add to Cart' }}
                </button>
              {% else %}
                <button type="button" disabled class="btn-sold-out">
                  {{ 'products.sold_out' | t | default: 'Sold Out' }}
                </button>
              {% endif %}
            </form>
          </div>
        </div>
      {% endfor %}
    </div>

    {% if paginate.pages > 1 %}
      <div class="flex flex-row justify-center" x-ref="pagination">
        {% render 'paginate', paginate: paginate %}
      </div>
    {% endif %}
  {% endpaginate %}
</div>

{% stylesheet %}
{% endstylesheet %}

{% schema %}
{
  "name": "All Products",
  "settings": [
    {
      "type": "text",
      "id": "custom_title",
      "label": "Custom page title",
      "info": "Leave blank to use 'All Products'"
    },
    {
      "type": "range",
      "id": "products_per_page",
      "label": "Products per page",
      "min": 8,
      "max": 24,
      "step": 4,
      "default": 12
    }
  ]
}
{% endschema %}
