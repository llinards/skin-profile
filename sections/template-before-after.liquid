<div class="container mx-auto px-4 pb-12 transition-hide" x-data="{ activeTab: 0, sliderValue: 50 }">
  <!-- Tabs Navigation -->
  {% if section.blocks.size > 0 %}
    <div class="flex justify-center mb-8 md:mb-12">
      <div class="inline-flex flex-wrap justify-center gap-2 md:gap-4">
        {% for block in section.blocks %}
          {% if block.type == 'tab' %}
            <button
              @click="activeTab = {{ forloop.index0 }}; sliderValue = 50"
              :class="activeTab === {{ forloop.index0 }} ? 'bg-sp-brown text-white' : 'bg-white text-sp-brown border-2 border-sp-brown'"
              class="px-4 md:px-6 py-2 md:py-3 rounded-full text-sm md:text-base font-medium transition-all duration-300 hover:bg-sp-brown hover:text-white"
            >
              {{ block.settings.tab_label }}
            </button>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  {% endif %}

  <!-- Tab Content -->
  {% for block in section.blocks %}
    {% if block.type == 'tab' %}
      <div
        x-show="activeTab === {{ forloop.index0 }}"
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        {{ block.shopify_attributes }}
      >
        <div class="md:flex md:gap-x-24 md:items-center">
          <!-- Left column: Text content -->
          <div class="flex flex-col md:w-1/2 items-center md:items-start justify-center space-y-6 md:space-y-12">
            <h2 class="text-center md:text-left">{{ block.settings.heading }}</h2>
            <div class="space-y-2 text-center md:text-left">
              {{ block.settings.text }}
            </div>

            <!-- Desktop Button -->
            {% if block.settings.button_text != blank and block.settings.button_url != blank %}
              <div class="hidden md:flex w-full justify-center md:justify-start">
                {% case block.settings.button_style %}
                  {% when 'white' %}
                    {% render 'btn-white', text: block.settings.button_text, url: block.settings.button_url %}
                  {% when 'brown' %}
                    {% render 'btn-brown', text: block.settings.button_text, url: block.settings.button_url %}
                {% endcase %}
              </div>
            {% endif %}
          </div>

          <!-- Right column: Before/After Slider -->
          <div class="w-full md:w-1/2 h-full">
            <div class="relative overflow-hidden">
              <!-- Before Image (base layer) -->
              <img
                src="{{ block.settings.before_image | image_url: width: 1024 }}"
                alt="{{ block.settings.alt_text }}"
                class="w-full block"
                width="1024"
                height="1024"
                loading="lazy"
              >

              <!-- After Image (clipped overlay) -->
              <div
                class="absolute bottom-0 left-0 top-0 z-10 bg-cover bg-left"
                x-bind:style="`width: ${sliderValue}%; background-image: url('{{ block.settings.after_image | image_url: width: 1024 }}');`"
              ></div>

              <!-- Range Input Slider -->
              <input
                type="range"
                min="0"
                max="100"
                x-model="sliderValue"
                class="absolute inset-0 z-20 cursor-ew-resize opacity-0 outline-0 w-full h-full"
              >

              <!-- Slider Handle -->
              <div
                class="pointer-events-none absolute bottom-0 top-0 z-30 flex items-center justify-center"
                x-bind:style="`left: ${sliderValue}%; transform: translateX(-50%);`"
              >
                <div class="absolute left-1/2 h-full w-1 -translate-x-1/2 bg-white shadow-lg"></div>
                <div class="flex h-12 w-12 items-center justify-center rounded-full bg-white shadow-lg">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="h-4 w-4"
                  >
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
                  </svg>
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="h-4 w-4"
                  >
                    <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
                  </svg>
                </div>
              </div>
            </div>
            <p class="uppercase text-sm text-gray-400 text-center mt-2 pb-6 md:pb-0">
              *{{ 'general.image_disclaimer' | t }}
            </p>
          </div>

          <!-- Mobile Button -->
          {% if block.settings.button_text != blank and block.settings.button_url != blank %}
            <div class="md:hidden flex justify-center w-full mt-6">
              {% case block.settings.button_style %}
                {% when 'white' %}
                  {% render 'btn-white', text: block.settings.button_text, url: block.settings.button_url %}
                {% when 'brown' %}
                  {% render 'btn-brown', text: block.settings.button_text, url: block.settings.button_url %}
              {% endcase %}
            </div>
          {% endif %}
        </div>
      </div>
    {% endif %}
  {% endfor %}
</div>

{% schema %}
{
  "name": "Pirms un Pēc Sadaļa",
  "settings": [],
  "blocks": [
    {
      "type": "tab",
      "name": "Zakładka / Tab",
      "limit": 4,
      "settings": [
        {
          "type": "text",
          "id": "tab_label",
          "label": "Tab Label",
          "default": "Tab",
          "info": "The label displayed on the tab button"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Virsraksts / Heading",
          "default": "Virsraksts šeit"
        },
        {
          "type": "richtext",
          "id": "text",
          "label": "Teksts / Text",
          "default": "<p>Jūsu teksts šeit.</p>"
        },
        {
          "type": "image_picker",
          "id": "before_image",
          "label": "Pirms attēls / Before Image"
        },
        {
          "type": "image_picker",
          "id": "after_image",
          "label": "Pēc attēls / After Image"
        },
        {
          "type": "text",
          "id": "alt_text",
          "label": "Attēla alt teksts / Image Alt Text",
          "default": "Before and After"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Pogas teksts / Button Text",
          "default": "Learn More"
        },
        {
          "type": "url",
          "id": "button_url",
          "label": "Pogas saite / Button Link"
        },
        {
          "type": "select",
          "id": "button_style",
          "label": "Pogas veids / Button Style",
          "options": [
            { "value": "white", "label": "Balta / White" },
            { "value": "brown", "label": "Brūna / Brown" }
          ],
          "default": "brown"
        }
      ]
    }
  ],
  "max_blocks": 4,
  "presets": [
    {
      "name": "Pirms un Pēc Sadaļa",
      "blocks": [
        {
          "type": "tab",
          "settings": {
            "tab_label": "Tab 1",
            "heading": "Virsraksts 1",
            "text": "<p>Pirmā zakładka saturs.</p>",
            "button_text": "Uzzināt vairāk"
          }
        }
      ]
    }
  ]
}
{% endschema %}
