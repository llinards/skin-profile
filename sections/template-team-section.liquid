<script>
  document.addEventListener('DOMContentLoaded', function () {
    const carousel = Carousel(document.getElementById('team-carousel'), {
      fill: true,
      infinite: false,
      plugins: [window.Dots],
    }).init();
  });
</script>
<div x-data="{ activeModal: null }">
  <div class="container mx-auto px-4 pb-12 transition-hide text-center md:text-left">
    {% if section.settings.is_page_title %}
      <h1 class="mb-6 md:mb-12">{{ section.settings.heading }}</h1>
    {% else %}
      <div class="flex flex-row justify-between mb-6 md:mb-12 ">
        <h2>{{ section.settings.heading }}</h2>
        <!--
          <div class="group flex items-center justify-end cursor-pointer border-b border-transparent hover:border-sp-brown transition-colors duration-150">
            <a class="text-gray-500 pr-2" href="{{ pages['komanda'].url }}">Skatīt visu</a>
            <span class="pointer-events-none">
              {% render 'icon-arrow' %}
            </span>
          </div>
        -->
      </div>
    {% endif %}

    {% if section.settings.use_grid_layout %}
      <!-- Grid Layout -->
      <div class="hidden md:grid grid-cols-2 lg:grid-cols-3 gap-x-12 gap-y-6 pb-12">
        {% for block in section.blocks %}
          <div
            class="h-full rounded-4xl cursor-pointer"
            @click="activeModal = '{{ block.id }}'; document.body.style.overflow = 'hidden'"
          >
            {% if block.settings.photo %}
              <div class="overflow-hidden h-156 rounded-4xl">
                <img
                  src="{{ block.settings.photo | image_url }}"
                  alt="{{ block.settings.name | escape }}"
                  width="1080"
                  height="1920"
                  loading="lazy"
                  class="rounded-4xl h-156 object-top object-cover transition-transform duration-300 ease-in-out hover:scale-105"
                >
              </div>
            {% endif %}
            <div class="flex w-full px-2 justify-between">
              <div class="pt-4">
                <h3 class="text-left">{{ block.settings.name }}</h3>
                <div class="text-sm text-left">{{ block.settings.position }}</div>
              </div>
              <div class="flex justify-end items-end mb-1">
                {% render 'icon-arrow' %}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
      <div class="md:hidden">
        <div class="f-carousel pb-6 md:pb-12" id="team-carousel">
          {% for block in section.blocks %}
            <div
              class="f-carousel__slide h-full rounded-4xl cursor-pointer"
              @click="activeModal = '{{ block.id }}'; document.body.style.overflow = 'hidden'"
            >
              {% if block.settings.photo %}
                <div class="overflow-hidden h-108 rounded-4xl">
                  <img
                    src="{{ block.settings.photo | image_url }}"
                    alt="{{ block.settings.name | escape }}"
                    width="1080"
                    height="1920"
                    loading="lazy"
                    class="rounded-4xl h-108 object-top object-cover transition-transform duration-300 ease-in-out hover:scale-105"
                  >
                </div>
              {% endif %}
              <div class="flex w-full px-2 justify-between">
                <div class="pt-4">
                  <h3 class="text-left">{{ block.settings.name }}</h3>
                  <div class="text-sm text-left">{{ block.settings.position }}</div>
                </div>
                <div class="flex justify-end items-end mb-1">
                  {% render 'icon-arrow' %}
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    {% else %}
      <!-- Carousel Layout -->
      <div class="f-carousel pb-6 md:pb-12" id="team-carousel">
        {% for block in section.blocks %}
          <div
            class="f-carousel__slide h-full rounded-4xl cursor-pointer"
            @click="activeModal = '{{ block.id }}'; document.body.style.overflow = 'hidden'"
          >
            {% if block.settings.photo %}
              <div class="overflow-hidden h-108 rounded-4xl">
                <img
                  src="{{ block.settings.photo | image_url }}"
                  alt="{{ block.settings.name | escape }}"
                  width="1080"
                  height="1920"
                  loading="lazy"
                  class="rounded-4xl h-108 object-top object-cover transition-transform duration-300 ease-in-out hover:scale-105"
                >
              </div>
            {% endif %}
            <div class="flex w-full px-2 justify-between">
              <div class="pt-4">
                <h3 class="text-left">{{ block.settings.name }}</h3>
                <div class="text-sm text-left">{{ block.settings.position }}</div>
              </div>
              <div class="flex justify-end items-end mb-1">
                {% render 'icon-arrow' %}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>

  <!-- Moved modals outside the carousel container -->
  {% for block in section.blocks %}
    <div
      x-show="activeModal === '{{ block.id }}'"
      x-cloak
      @click.self="activeModal = null; document.body.style.overflow = 'auto'"
      class="fixed inset-0 z-51 flex items-center justify-center bg-black/50 px-4 py-8"
      x-transition:enter="transition ease-out duration-300"
      x-transition:enter-start="opacity-0"
      x-transition:enter-end="opacity-100"
      x-transition:leave="transition ease-in duration-200"
      x-transition:leave-start="opacity-100"
      x-transition:leave-end="opacity-0"
    >
      <div
        class="bg-white rounded-4xl shadow-xl w-full md:max-w-5xl xl:max-w-6xl max-w-lg transform"
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0 scale-95"
        x-transition:enter-end="opacity-100 scale-100"
        x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="opacity-100 scale-100"
        x-transition:leave-end="opacity-0 scale-95"
        @click.stop
      >
        <!-- Modal content -->
        <div class="p-6 md:flex items-center relative">
          <button
            @click="activeModal = null; document.body.style.overflow = 'auto'"
            class="absolute top-10 right-10 md:top-8 md:right-8 text-2xl leading-none z-10"
          >
            {% render 'icon-mobile-menu-close', class: 'fill-white hover:fill-sp-brown md:fill-black' %}
          </button>
          {% if block.settings.photo %}
            <div class="md:w-3/7">
              <img
                src="{{ block.settings.photo | image_url }}"
                alt="{{ block.settings.name | escape }}"
                width="1080"
                height="1920"
                loading="lazy"
                class="w-full max-h-80 sm:max-h-96 md:max-h-150 rounded-3xl object-cover object-top min-[440px]:object-[center_10%] md:object-top mb-2 md:mb-0"
              >
            </div>
          {% endif %}
          <div class="flex md:w-4/7 flex-col justify-center md:px-12 lg:px-18 xl:px-24 space-y-4">
            <div class="space-y-1">
              <h3 class="text-3xl lg:text-4xl capitalize">{{ block.settings.name }}</h3>
              <p class="font-bold">{{ block.settings.position }}</p>
            </div>

            {% if block.settings.specialities != blank %}
              <div class="space-y-1">
                <p class="uppercase font-bold">Specializācija</p>
                {{ block.settings.specialities }}
              </div>
            {% endif %}

            {% if block.settings.identificator != blank %}
              <div class="w-full bg-sp-light-brown rounded-full">
                <div class="p-2 md:p-4 text-center space-y-1 text-xs md:text-sm">
                  <p class="uppercase font-bold text-center">Ārstniecības personas identifikators:</p>
                  {{ block.settings.identificator }}
                </div>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  {% endfor %}
</div>

{% schema %}
{
  "name": "Komanda",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Virsraksts",
      "default": "Komanda"
    },
    {
      "type": "checkbox",
      "id": "is_page_title",
      "label": "Vai šis ir lapas virsraksts?",
      "default": false,
      "info": "Ja ieslēgts, virsraksts tiks attēlots kā H1 (lapas galvenais virsraksts). Ja izslēgts, tiks izmantots H2."
    },
    {
      "type": "checkbox",
      "id": "use_grid_layout",
      "label": "Izmantot režģa izkārtojumu (nevis karuseli)",
      "default": false,
      "info": "Ja ieslēgts, komandas biedri tiks attēloti 3 kolonnu režģī (desktop). Mobilajā versijā vienmēr 1 kolonna."
    }
  ],
  "blocks": [
    {
      "type": "member",
      "name": "Komandas biedrs",
      "settings": [
        {
          "type": "image_picker",
          "id": "photo",
          "label": "Foto"
        },
        {
          "type": "text",
          "id": "name",
          "label": "Vārds"
        },
        {
          "type": "text",
          "id": "position",
          "label": "Amats"
        },
        {
          "type": "richtext",
          "id": "specialities",
          "label": "Specializācija"
        },
        {
          "type": "text",
          "id": "identificator",
          "label": "Ārstniecības personas identifikators"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Komanda",
      "blocks": [
        {
          "type": "member",
          "settings": {
            "name": "Jane Doe",
            "position": "Founder"
          }
        }
      ]
    }
  ]
}
{% endschema %}
