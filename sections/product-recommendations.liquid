<div
  class="container mx-auto px-4 pb-12 relative"
  x-data="{ loading: true, hasRecommendations: false }"
  x-init="loading = true"
  x-show="hasRecommendations"
  @recommendations-loaded="loading = false"
  @recommendations-found="hasRecommendations = true"
  style="display: none;"
>
  <h2 class="text-3xl md:text-4xl font-bold mb-8">Līdzīgi produkti</h2>

  <div
    x-show="loading"
    x-transition
    class="absolute inset-0 flex items-center justify-center bg-white bg-opacity-75 z-10"
  >
    <div class="loading-spinner"></div>
  </div>

  <!-- Product Grid -->
  <div class="pb-6 md:pb-12">
    <recommended-products
      data-url="{{ routes.product_recommendations_url }}?limit={{ section.settings.products_to_show }}"
      data-product-id="{{ product.id }}"
      data-section-id="{{ section.id }}"
    >
      {% if recommendations.performed and recommendations.products_count > 0 %}
        <div
          id="productRecommendationCarousel"
          class="f-carousel transition-opacity duration-300"
          :class="{ 'opacity-30': loading }"
        >
          {% for recommendation in recommendations.products %}
            <div class="f-carousel__slide flex flex-col justify-between space-y-3">
              {% render 'product-card', product: recommendation %}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </recommended-products>
  </div>
</div>

<script src="{{ 'recommended-products.js' | asset_url }}" defer></script>

{% stylesheet %}
  .loading-spinner {
    width: 40px;
    height: 40px;
    border: 4px solid #f3f3f3;
    border-top: 4px solid #885642;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Recommended Products",
  "settings": [
    {
      "type": "range",
      "id": "products_to_show",
      "label": "Products to show",
      "min": 0,
      "max": 10,
      "default": 4,
      "step": 1
    }
  ],
  "presets": [
    {
      "name": "Recommended Products"
    }
  ]
}
{% endschema %}
