<script src="{{ 'product-recommendations.js' | asset_url }}" defer></script>

<div
  x-data="{ loading: true, hasRecommendations: false }"
  x-init="loading = true"
  x-cloak
  @carousel-initialized="loading = false"
  @recommendations-found="hasRecommendations = true"
>
  <div x-show="hasRecommendations" x-transition:enter>
    <div class="container mx-auto px-4 pb-12 relative">
      <h2 class="text-3xl md:text-4xl font-bold mb-8">Līdzīgi produkti</h2>

      <!-- Skeleton Loader -->
      <div
        x-show="loading"
        class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 md:gap-12"
      >
        <template x-for="i in 4">
          <div class="animate-pulse">
            <div class="bg-gray-200 aspect-square rounded-lg mb-3"></div>
            <div class="h-4 bg-gray-200 rounded mb-2"></div>
            <div class="h-4 bg-gray-200 rounded w-2/3"></div>
          </div>
        </template>
      </div>

      <!-- Actual Products -->
      <div x-show="!loading" class="pb-6 md:pb-12">
        <recommended-products
          data-url="{{ routes.product_recommendations_url }}?limit={{ section.settings.products_to_show }}"
          data-product-id="{{ product.id }}"
          data-section-id="{{ section.id }}"
        >
          {% if recommendations.performed and recommendations.products_count > 0 %}
            <div id="product-recommendation-carousel" class="f-carousel">
              {% for recommendation in recommendations.products %}
                <div class="f-carousel__slide flex flex-col justify-between space-y-3">
                  {% render 'product-card', product: recommendation %}
                </div>
              {% endfor %}
            </div>
          {% endif %}
        </recommended-products>
      </div>
    </div>
  </div>
</div>

{% stylesheet %}
  [x-cloak] {
    display: none !important;
  }

  .loading-spinner {
    width: 40px;
    height: 40px;
    border: 4px solid #f3f3f3;
    border-top: 4px solid var(--color-brand-primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Recommended Products",
  "settings": [
    {
      "type": "range",
      "id": "products_to_show",
      "label": "Products to show",
      "min": 0,
      "max": 10,
      "default": 4,
      "step": 1
    }
  ],
  "presets": [
    {
      "name": "Recommended Products"
    }
  ]
}
{% endschema %}
