{%- assign vendor_param = 'filter.v.vendor' -%}
{%- assign vendor_filter = collection.filters | where: 'param_name', vendor_param | first -%}

{%- assign current_vendor = 'Ražotājs' -%}
{%- if vendor_filter.active_values.size > 0 -%}
  {%- assign current_vendor = vendor_filter.active_values.first.label -%}
{%- endif -%}

{%- comment -%} --- Logic to preserve OTHER active filters (like Category or Price) --- {%- endcomment -%}
{%- assign other_active_filters = '' -%}
{%- for param in request.query -%}
  {%- if param.first contains 'filter.' and param.first != vendor_param -%}
    {%- for value in param.last -%}
      {%- assign other_active_filters = other_active_filters
        | append: '&'
        | append: param.first
        | append: '='
        | append: value
      -%}
    {%- endfor -%}
  {%- endif -%}
{%- endfor -%}

{%- assign sort_by_param = '' -%}
{%- if request.query.sort_by -%}
  {%- assign sort_by_param = 'sort_by=' | append: request.query.sort_by -%}
{%- endif -%}
{%- comment -%} -------------------------------------------------------------------- {%- endcomment -%}

{%- capture dropdown_content -%}
  {%- if vendor_filter and vendor_filter.values.size > 0 -%}
    <a href="{{ collection.url }}?{{ other_active_filters | remove_first: '&' }}{% if sort_by_param %}&{{ sort_by_param }}{% endif %}" class="block px-4 py-2 text-sm hover:bg-gray-100 transition-colors filter-link">
      Visi ražotāji
    </a>
    {%- for value in vendor_filter.values -%}
      {%- assign new_url = collection.url
        | append: '?'
        | append: value.param_name
        | append: '='
        | append: value.value
        | append: other_active_filters
      -%}
      {%- if sort_by_param -%}
        {%- assign new_url = new_url | append: '&' | append: sort_by_param -%}
      {%- endif -%}
      <a
        href="{{ new_url }}"
        class="block px-4 py-2 text-sm hover:bg-gray-100 transition-colors filter-link {% if value.active %}bg-gray-50 font-semibold{% endif %}"
      >
        {{ value.label }} <span class="text-gray-500 text-xs">({{ value.count }})</span>
      </a>
    {%- endfor -%}
  {%- else -%}
    <div class="px-4 py-2 text-sm text-gray-500">Ražotāju filtrs nav pieejams.</div>
  {%- endif -%}
{%- endcapture -%}

{% render 'filter', filter_text: 'Ražotājs', current_value: current_vendor, dropdown_content: dropdown_content %}
