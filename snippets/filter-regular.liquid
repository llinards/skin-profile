{%- comment -%} Regular Filters (Multi-Select) {%- endcomment -%}
{% for filter in collection.filters %}
  {% if filter.type == 'list' or filter.type == 'price_range' %}
    {%- assign current_value = filter.label -%}

    {%- comment -%} Show count if active {%- endcomment -%}
    {%- if filter.active_values.size > 0 -%}
      {%- assign current_value = filter.label | append: ' (' | append: filter.active_values.size | append: ')' -%}
    {%- endif -%}

    {%- capture dropdown_content -%}
      <div class="filter-group-container">
        {%- comment -%} "Clear this filter" option {%- endcomment -%}
        <div class="px-4 py-2 border-b border-gray-100">
          <button 
            type="button" 
            class="text-xs text-gray-500 hover:text-sp-brown underline cursor-pointer w-full text-left"
            @click.prevent="window.clearFilterGroup && window.clearFilterGroup('{{ filter.param_name | escape }}')"
          >
            {{ 'collections.filters.clear' | t }}
          </button>
        </div>

        {%- comment -%} Filter values as Checkboxes {%- endcomment -%}
        <div class="max-h-60 overflow-y-auto">
          {%- for value in filter.values -%}
            {%- if filter.param_name == 'filter.p.vendor' -%}
              {%- assign display_label = value.label -%}
            {%- else -%}
              {%- assign value_key = value.value | handleize | replace: '-', '_' -%}
              {%- assign filter_key = filter.param_name | handleize | replace: '-', '_' -%}
              {%- assign translation_key = 'filters.values.' | append: filter_key | append: '.' | append: value_key -%}
              {%- assign translated_label = translation_key | t -%}

              {%- if translated_label contains 'Translation missing' -%}
                {%- assign display_label = value.label -%}
              {%- else -%}
                {%- assign display_label = translated_label -%}
              {%- endif -%}
            {%- endif -%}

            <label class="flex items-center px-4 py-2 hover:bg-gray-50 cursor-pointer transition-colors">
              <input 
                type="checkbox" 
                name="{{ value.param_name }}" 
                value="{{ value.value }}"
                class="filter-checkbox accent-sp-brown rounded border-gray-300 text-sp-brown focus:ring-sp-brown mr-3 size-4"
                {% if value.active %}checked{% endif %}
                data-param="{{ filter.param_name | escape }}"
              >
              <span class="text-sm ml-3 {% if value.active %}font-semibold{% endif %}">
                {{ display_label }}
              </span>
              <span class="ml-auto text-xs text-gray-400 pl-2">({{ value.count }})</span>
            </label>
          {%- endfor -%}
        </div>
      </div>
    {%- endcapture -%}

    {% render 'filter-dropdown',
      filter_text: filter.label,
      current_value: current_value,
      dropdown_content: dropdown_content
    %}
  {% endif %}
{% endfor %}
