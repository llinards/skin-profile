{% if paginate.pages > 0 %}
  <nav class="flex justify-center py-12 space-x-6" role="navigation">
    {% if paginate.previous %}
      <a
        class="bg-sp-light-brown-opacity px-6 py-3 rounded-xl hover:bg-sp-brown hover:text-white transition-all duration-200 pagination-link"
        href="{{ paginate.previous.url }}"
      >
        {{ paginate.previous.title }}
      </a>
    {% endif %}

    {% for part in paginate.parts %}
      {% if part.is_link %}
        <a
          class="bg-sp-light-brown-opacity px-6 py-3 rounded-xl transition-all duration-200 hover:bg-sp-brown hover:text-white pagination-link"
          href="{{ part.url }}"
        >
          {{ part.title }}
        </a>
      {% else %}
        <span class="bg-sp-light-brown px-6 py-3 rounded-xl transition-all duration-200">
          {{ part.title }}
        </span>
      {% endif %}
    {% endfor %}

    {% if paginate.next %}
      <a
        class="bg-sp-light-brown-opacity px-6 py-3 rounded-xl hover:bg-sp-brown hover:text-white transition-all duration-200 pagination-link"
        href="{{ paginate.next.url }}"
      >
        {{ paginate.next.title }}
      </a>
    {% endif %}
  </nav>
{% endif %}

<script>
  function collectionPagination() {
    return {
      loading: false,

      init() {
        this.attachPaginationListeners();
      },

      attachPaginationListeners() {
        const pagination = this.$refs.pagination;
        if (!pagination) return;

        const links = pagination.querySelectorAll('a.pagination-link');
        links.forEach((link) => {
          link.addEventListener('click', (e) => {
            e.preventDefault();
            this.loadPage(link.href);
          });
        });
      },

      async loadPage(url) {
        if (this.loading) return;

        // Start loading state
        this.loading = true;

        try {
          const response = await fetch(url);
          const html = await response.text();
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, 'text/html');

          // Add a small delay for smooth transition (optional)
          await new Promise((resolve) => setTimeout(resolve, 300));

          // Update product grid
          const newGrid = doc.querySelector('[x-ref="productGrid"]');
          if (newGrid) {
            this.$refs.productGrid.innerHTML = newGrid.innerHTML;
          }

          // Update pagination
          const newPagination = doc.querySelector('[x-ref="pagination"]');
          if (newPagination && this.$refs.pagination) {
            this.$refs.pagination.innerHTML = newPagination.innerHTML;
            this.attachPaginationListeners();
          }

          // Update URL without refresh
          window.history.pushState({}, '', url);

          // Smooth scroll to top of products
          this.$refs.productGrid.scrollIntoView({
            behavior: 'smooth',
            block: 'start',
          });
        } catch (error) {
          console.error('Failed to load page:', error);
          // Show error message (optional)
          alert('Failed to load products. Please try again.');
          // Fallback to regular navigation
          window.location.href = url;
        } finally {
          // End loading state
          this.loading = false;
        }
      },
    };
  }
</script>
