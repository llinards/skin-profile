{%- comment -%} Sort By {%- endcomment -%}
{%- assign sort_options = 'manual,best-selling,title-ascending,title-descending,price-ascending,price-descending,created-ascending,created-descending'
  | split: ','
-%}
{%- assign sort_labels = 'collections.sort.label,collections.sort.popular,collections.sort.name_asc,collections.sort.name_desc,collections.sort.price_asc,collections.sort.price_desc,collections.sort.oldest,collections.sort.newest'
  | split: ','
-%}
{%- assign selected_sort_key = collection.sort_by | default: collection.default_sort_by -%}

{%- assign filter_params = '' -%}
{%- for filter in collection.filters -%}
  {%- for value in filter.active_values -%}
    {%- assign filter_params = filter_params
      | append: '&'
      | append: value.param_name
      | append: '='
      | append: value.value
    -%}
  {%- endfor -%}
{%- endfor -%}

{%- capture dropdown_content -%}
  {%- for option in sort_options -%}
    {%- assign sort_url = collection.url | append: '?sort_by=' | append: option | append: filter_params -%}
    <a
      href="{{ sort_url }}"
      class="block px-4 py-2 text-sm transition-colors filter-link {% if selected_sort_key == option %}bg-(--color-brand-primary) text-white font-semibold {% else %} hover:bg-sp-light-brown{% endif %}"
    >
      {{ sort_labels[forloop.index0] | t }}
    </a>
  {%- endfor -%}
{%- endcapture -%}

{%- assign sort_label_text = 'collections.sort.label' | t -%}

{%- comment -%} Find the currently selected sort option and translate it {%- endcomment -%}
{%- assign current_sort_label = sort_label_text -%}
{%- for option in sort_options -%}
  {%- if selected_sort_key == option -%}
    {%- assign current_sort_label = sort_labels[forloop.index0] | t -%}
    {%- break -%}
  {%- endif -%}
{%- endfor -%}

{%- comment -%} Create JSON object with translated labels for JavaScript {%- endcomment -%}
<script>
  window.sortLabelsTranslated = {
    'manual': {{ 'collections.sort.label' | t | json }},
    'best-selling': {{ 'collections.sort.popular' | t | json }},
    'title-ascending': {{ 'collections.sort.name_asc' | t | json }},
    'title-descending': {{ 'collections.sort.name_desc' | t | json }},
    'price-ascending': {{ 'collections.sort.price_asc' | t | json }},
    'price-descending': {{ 'collections.sort.price_desc' | t | json }},
    'created-ascending': {{ 'collections.sort.oldest' | t | json }},
    'created-descending': {{ 'collections.sort.newest' | t | json }}
  };
</script>

{% render 'filter-dropdown',
  filter_text: sort_label_text,
  current_value: current_sort_label,
  label_id: 'sort-by-label',
  dropdown_content: dropdown_content
%}
