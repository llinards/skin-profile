{% assign is_mobile = mobile | default: false %}

{% if is_mobile %}
  {%- assign submenu_id = 'submenu-' | append: link.title | handleize -%}
  <div
    x-data="
      {
        open: false,
        h: 0,
        toggle() {
          this.open = !this.open;
          this.$nextTick(() => {
            this.h = this.open ? (this.$refs.panel?.scrollHeight || 0) : 0;
          });
        }
      }
    "
    class="w-full max-w-sm mx-auto flex flex-col items-center"
  >
    <button
      type="button"
      @click="toggle()"
      class="w-full inline-flex items-center justify-center gap-2 py-2 text-center"
      :aria-expanded="open.toString()"
      :aria-controls="'{{ submenu_id }}'"
      aria-haspopup="true"
    >
      <span class="truncate">{{- link.title -}}</span>
      <svg
        class="h-5 w-5 transition-transform duration-200"
        :class="open ? 'rotate-180' : ''"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        stroke-width="1.8"
        aria-hidden="true"
      >
        <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path>
      </svg>
    </button>

    {% if link.links and link.links.size > 0 %}
      <div
        id="{{ submenu_id }}"
        x-ref="panel"
        :style="`max-height:${h}px`"
        class="w-full overflow-hidden transition-[max-height] duration-300 ease-out"
        role="region"
        :aria-hidden="(!open).toString()"
      >
        <ul class="mt-2 space-y-2 list-none text-center">
          {% for child in link.links %}
            <li>
              <a href="{{ child.url }}" class="inline-block px-3 py-2 hover:bg-neutral-100 rounded">
                {{ child.title }}
              </a>
            </li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}
  </div>
{% else %}
  <div
    x-data="
      {
        isOpen: false,
        t: null,
        enter() { clearTimeout(this.t); this.isOpen = true },
        leave() { this.t = setTimeout(() => this.isOpen = false, 120) }
      }
    "
    @mouseenter="enter()"
    @mouseleave="leave()"
    class="relative"
  >
    <a
      href="{{ link.url }}"
      class="flex lg:text-white text-base xl:text-lg items-center py-2 border border-transparent hover:border-b-white transition-all duration-300"
      aria-haspopup="true"
      :aria-expanded="isOpen.toString()"
    >
      {{- link.title -}}
      {% render 'icon-arrow-down' %}
    </a>

    {% if link.links and link.links.size > 0 %}
      <div
        x-show="isOpen"
        x-transition.opacity.duration.150ms
        class="hidden lg:block absolute left-1/2 -translate-x-1/2 top-full mt-2 z-50"
      >
        <div class="w-36 rounded-md bg-white shadow-xl ring-1 ring-black/5 overflow-hidden">
          <ul class="py-2 text-center list-none">
            {% for child in link.links %}
              <li>
                <a href="{{ child.url }}" class="block px-3 py-2 text-sm hover:bg-neutral-100">
                  {{ child.title }}
                </a>
              </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    {% endif %}
  </div>
{% endif %}
