{%- assign disclaimer = disclaimer | default: '' -%}
{%- assign services = services | default: section.blocks -%}
{%- assign apply_url_default = apply_url_default | default: pages['appointment-booking'].url -%}
{%- assign apply_cta = apply_cta | default: 'Pieteikt' -%}

{%- assign procedure_blocks = services | where: 'type', 'procedure' -%}

<div class="space-y-0 mb-6 md:mb-12">
  {%- if procedure_blocks.size > 0 -%}
    <div class="mb-4 flex justify-end">
      <div class="w-full md:w-auto">
        {% render 'btn-brown', text: apply_cta, url: apply_url_default, full_width: true %}
      </div>
    </div>

    <!-- Desktop table header -->
    <div class="hidden md:grid md:grid-cols-15 gap-4 font-bold items-center py-3 border-b-2 border-sp-light-brown">
      <div class="col-span-4 text-left text-sm">{{ 'general.procedure_table.procedure' | t }}</div>
      <div class="col-span-4 lg:col-span-5 text-left text-sm">{{ 'general.procedure_table.description' | t }}</div>
      <div class="col-span-2 text-center text-sm">{{ 'general.procedure_table.price' | t }}</div>
      <div class="col-span-2 text-center text-sm">{{ 'general.procedure_table.duration' | t }}</div>
      <div class="col-span-3 lg:col-span-2 text-right text-sm">
        {{ 'general.procedure_table.contraindications' | t }}
      </div>
    </div>

    {%- for b in procedure_blocks -%}
      {%- assign procedure_name = b.settings.procedure_name | default: '' -%}
      {%- assign procedure_description = b.settings.procedure_description | default: '' -%}
      {%- assign procedure_price = b.settings.procedure_price | default: '' -%}
      {%- assign procedure_duration = b.settings.procedure_duration | default: '' -%}
      {%- assign contraindications_text = b.settings.contraindications_text | default: '' -%}

      <div class="border-b border-sp-light-brown border-dotted py-4">
        <!-- Desktop row -->
        <div class="hidden md:grid md:grid-cols-15 gap-4 items-center">
          <div class="col-span-4 text-left text-sm font-bold wrap-break-words">{{ procedure_name }}</div>
          <div class="col-span-4 lg:col-span-5 text-left text-sm text-gray-500 wrap-break-words">
            {{ procedure_description }}
          </div>
          <div class="col-span-2 text-center text-sm font-bold">{{ procedure_price }}</div>
          <div class="col-span-2 text-center text-sm text-gray-500">
            {%- if procedure_duration != blank -%}
              {{ procedure_duration }}
              {{ 'general.procedure_table.min' | t }}
            {%- endif -%}
          </div>
          <div class="col-span-3 lg:col-span-2 text-center flex items-center justify-end">
            {%- if contraindications_text != blank -%}
              <button
                type="button"
                @click="showContraModal = true; activeContraText = {{ contraindications_text | json | escape }}; activeContraName = {{ procedure_name | json | escape }}"
                class="text-sp-brown text-sm font-bold underline hover:no-underline transition-all duration-300 cursor-pointer"
              >
                {{ 'general.procedure_table.learn_more' | t }}
              </button>
            {%- endif -%}
          </div>
        </div>

        <!-- Mobile row -->
        <div class="md:hidden space-y-4">
          <div class="space-y-2">
            <div class="font-bold text-sm wrap-break-words">{{ procedure_name }}</div>
            {%- if procedure_description != blank -%}
              <div class="text-sm text-gray-500 wrap-break-words">{{ procedure_description }}</div>
            {%- endif -%}
          </div>

          <div class="grid grid-cols-3 gap-3 text-sm items-end">
            <div class="space-y-1">
              <div class="text-gray-500">{{ 'general.procedure_table.price' | t }}</div>
              <div class="font-bold">{{ procedure_price }}</div>
            </div>
            <div class="space-y-1">
              <div class="text-gray-500">{{ 'general.procedure_table.duration' | t }}</div>
              <div class="font-bold">
                {%- if procedure_duration != blank -%}
                  {{ procedure_duration }}
                  {{ 'general.procedure_table.min' | t }}
                {%- endif -%}
              </div>
            </div>
            <div class="space-y-1">
              <div class="font-bold text-xs">{{ 'general.procedure_table.contraindications' | t }}</div>
              {%- if contraindications_text != blank -%}
                <button
                  type="button"
                  @click="showContraModal = true; activeContraText = {{ contraindications_text | json | escape }}; activeContraName = {{ procedure_name | json | escape }}"
                  class="text-sp-brown underline hover:no-underline font-bold transition-all cursor-pointer text-left"
                >
                  {{ 'general.procedure_table.learn_more' | t }}
                </button>
              {%- endif -%}
            </div>
          </div>
        </div>
      </div>
    {%- endfor -%}
  {%- else -%}
    <div class="py-4 text-center text-gray-500 text-sm">{{ 'general.procedure_table.no_procedures' | t }}</div>
  {%- endif -%}

  {%- if disclaimer != blank -%}
    <p class="text-gray-500 mt-6 text-sm">{{ disclaimer }}</p>
  {%- endif -%}
</div>
